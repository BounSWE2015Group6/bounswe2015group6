<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>HodgePodge</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/theme.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="css/vis.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="js/vis.min.js"></script>

  </head>

  <body role="document">
    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">HodgePodge</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <form style="display:none;" id="loginform" class="navbar-form navbar-right">
            <div class="form-group">
              <input id="username" type="text" placeholder="Username" class="form-control" required>
            </div>
            <div class="form-group">
              <input id="password" type="password" placeholder="Password" class="form-control" required>
            </div>
            <button id="loginButton" type="submit" class="btn btn-success">Sign in</button>
            <button data-toggle="modal" data-target="#registerPage" type="button" class="btn btn-info">Sign up</button>
          </form>
          <div id="logindetails">
            <ul class="nav navbar-nav navbar-right">
              <li><a href="./myprofile.html"><span class="glyphicon glyphicon-user"></span><span id="profile"></span></a></li>
              <li><a href="#" id="logoutbtn"><span class="glyphicon glyphicon-log-out"></span>Logout</a></li>
            </ul>
          </div>
        </div><!--/.navbar-collapse -->
      </div>
    </nav>

<!--SIGN UP MODAL-->
    <div id="registerPage" class="modal fade" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Register</h4>
          </div>
          <div class="modal-body">
            <div style="display:none;" id="registerMessages"></div>
            <form id="registerform" class="form-horizontal" role="form">
              <div class="form-group">
                <label class="control-label col-sm-2" for="username">Username:</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="registerUsername" placeholder="Enter username" data-minlength="6" required>
                </div>
              </div>
              <div class="form-group">
                <label class="control-label col-sm-2" for="registerEmail">Email:</label>
                <div class="col-sm-10">
                  <input type="email" class="form-control" id="registerEmail" placeholder="Enter email" required>
                </div>
              </div>
              <div class="form-group">
                <label class="control-label col-sm-2" for="registerPassword">Password:</label>
                <div class="col-sm-10"> 
                  <input type="password" class="form-control" id="registerPassword" placeholder="Enter password" required>
                </div>
              </div>
              <div class="form-group"> 
                <div class="col-sm-offset-2 col-sm-10">
                  <button id="registerButton" type="submit" class="btn btn-default">Submit</button>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
<!--END OF SIGN UP MODAL-->
    <div class="container theme-showcase" role="main">

      <div class="row">
        <div style="display:none;" id="loginMessages"></div>
        <div class="col-sm-12" id="titleAndRating">
          <div class="col-sm-9" id="titleAndGroup">
            <div class="col-sm-12" id="title"></div>
            <div class="col-sm-12" id="group"></div>
            <div class="col-sm-12" id="seeGraph"></div>
          </div>
          <div class="col-sm-3" style="border-left: solid #000000;">
            <div class="col-sm-12" id='rMessage'></div>
            <div style="float:right" class="col-sm-12"><h3 style="text-align:center">Rating</h3></div>
            <div style="float:right; display:none" class="col-sm-12" id="upVoteTopic">
              <p style="text-align:center"><a href='#' id="upVote"><span class="glyphicon glyphicon-menu-up" style="font-size:2em"></span></a><p>
            </div>
            <div style="float:right" class="col-sm-12" id="rating"></div>
            <div style="float:right; display:none" class="col-sm-12" id="downVoteTopic">
              <p style="text-align:center"><a href='#' id="downVote"><span class="glyphicon glyphicon-menu-down" style="font-size:2em"></span></a><p>
            </div>
          </div>
        </div>
      </div>

      <div class="row" style="margin-bottom:10px">
        <ul class="nav nav-tabs nav-justified">
          <li class="active"><a data-toggle="tab" href="#Posts">Posts</a></li>
          <li><a data-toggle="tab" href="#Tags">Tags</a></li>
          <li><a data-toggle="tab" href="#Relations">Relations</a></li>
        </ul>

        <div class="tab-content">
          <div id="Posts" class="tab-pane fade in active">

            <div class="col-sm-12" style="margin-top:20px; margin-bottom:20px">
            <button type="button" data-toggle="collapse" data-target="#postScreen" class="btn btn-primary" id="wannaPost" style="display:none">Wanna Post?</button>
            </div> 
            <div style="display:none; clear:both" id="createPostMessages"></div>
            <div id="postScreen" class="panel panel-primary collapse" style="margin-top:20px; padding-top:10px; clear:both">
              <div class="panel panel-body">
              <div class="col-sm-12">
              <div class="col-sm-7" style="margin-bottom:0px">
                  <textarea id="postText" rows="3" cols="80" class="form-control" placeholder="Post something!" data-minlength="2" required></textarea>
              </div> 
              <div class="col-sm-4">
                  <b><span class="col-sm-12">Tags:</span></b>
                  <input type="text" id="tag1" placeholder="Please enter a tag." data-minlength='2'>
                  <input type="text" id="tag2" placeholder="Please enter a tag." data-minlength='2'>
                  <input type="text" id="tag3" placeholder="Please enter a tag." data-minlength='2'>
                  <input type="text" id="tag4" placeholder="Please enter a tag." data-minlength='2'>
              </div>
              <div class="col-sm-1" style="margin-top:20px">
                <button id="sendPostButton" type="submit" class="btn btn-primary">Send</button>
              </div>
              </div>
            </div>
            </div>
          </div>

          <div id="Tags" class="tab-pane fade">
              <div style="display:none; clear:both; margin-top:20px" id="addTagMessages"></div>
              <h2><span id="tagsName"></span></h2>
              <div class="input-group col-sm-4" style='margin-top:20px' id="newTagAddition">
                <input type="text" class="form-control" placeholder="New tag" id="newTag">
                <div class="input-group-btn">
                  <button class="btn btn-success" onClick="addNewTag('')"><i class="glyphicon glyphicon-plus" style='color:white'></i></button>
                </div>
              </div>
          </div>
          <div id="Relations" class="tab-pane fade">
              <div style="display:none; clear:both; margin-top:20px" id="addRelationMessages"></div>
              <div class="col-sm-12" id="relationsName"></div>
              <div class="col-sm-12" style='margin-top:20px; padding-left:0px' id="newRelationAddition">
                    <div class="col-sm-5" style="padding-left:0px">
                      <input class="form-control" type="text" id="topic1" placeholder="Please enter a topic name" data-minlength="3" required>
                      <input style="display:none" type="text" id="topicId1" value="0">
                    </div>
                    <div class="col-sm-1" id="checkTopic"></div>
                    <div class="col-sm-5">
                      <input type="text" class="form-control" id="relation1" placeholder="Please enter a reason for the relation" data-minlength="3" required>
                    </div>
                    <div class="col-sm-1">
                      <button class="btn btn-success" id="createRelationButton" onClick="addNewRelation(1)"><i class="glyphicon glyphicon-plus" style='color:white'></i></button>
                    </div>
              </div> 
          </div>

        </div>
      </div>

      <footer>
        <p>&copy; HodgePodge 2015</p>
      </footer>
    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="assets/js/docs.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="assets/js/ie10-viewport-bug-workaround.js"></script>

    <script src="js/validator.js"></script>
    <script src="js/jquery.cookie.js"></script>

<script>

var api = 'http://ec2-52-27-36-39.us-west-2.compute.amazonaws.com:8080';
var id = Number(GetURLParameter('id'));
var rating = 0;

$(function(){
  if($.cookie('username')) {
    $('#profile').html($.cookie('username'));
    $('#logindetails').show();
    $('#loginform').hide();
    $('#upVoteTopic').show();
    $('#downVoteTopic').show();
    $('#wannaPost').show();
    $(".upVote1").show();
    $('#newTagAddition').show();
    $('#newRelationAddition').show();
  } else {
    $('#logindetails').hide();
    $('#loginform').show();
    $('#upVoteTopic').hide();
    $('#downVoteTopic').hide();
    $('#wannaPost').hide();
    $('.upVote1').hide();
    $('#newTagAddition').hide();
    $('#newRelationAddition').hide();
  }

  $.ajax({
    url: api + "/api/topic/id/" + id,
    success: function(data){
      
      if (data.result.result === "OK") {
        var tagsOfTopic = [];
        var tagsTab = 'Tags: ';
        var html_1 = '<h2>' + data.title + '</h2>';
        var html_3 = '<h4>Group: <i>' + data.group + '</i></h4>';
        var html_4 = '<a href="./graph.html?nodeId=' + id + '"><button class="btn btn-primary col-sm-6">Wanna See ' + data.title +  ' on Graph?</button></a>';
        rating = Number(data.upVote) + Number(data.downVote);
        var html_2 = "<h3 style='text-align:center; margin-top:0px' >" + rating + "</h3>";
        $('#title').html(html_1);
        $('#group').html(html_3);
        $('#seeGraph').html(html_4);
        $('#rating').html(html_2);
        html_1 = "";

        for (var i = 0; i < data.posts.length; i++) {
          tagsTab = 'Tags: ';
          for(var j = 0; j < data.posts[i].tagsOfPost.length; j++){
            if((j+1)==data.posts[i].tagsOfPost.length){
              tagsTab += "<a href='./search.html?query=" + data.posts[i].tagsOfPost[j] + "' style='color:black'>" + data.posts[i].tagsOfPost[j] + "</a> ";
            }
            else{
              tagsTab += "<a href='./search.html?query=" + data.posts[i].tagsOfPost[j] + "' style='color:black'>" + data.posts[i].tagsOfPost[j] + "</a>, ";
            }
          }
          var deleteCheck = Number(data.posts[i].ownerId) == Number($.cookie('id')) ? "block" : "none";

          html_1 = "<div style='display:none;'' id='deleteMessage" + data.posts[i].id + "'></div><div id='" + id + "-" + data.posts[i].id + "' class='panel panel-primary' style='padding-top:0px; clear:both; height:300px'><div class='panel panel-heading' style='margin-top:0px; margin-bottom:0px'><div class='row'><div class='col-sm-8'>Post Id: "+ data.posts[i].id +"</div><div class='col-sm-3'><p style='text-align:right'>CreatedBy: <a href='./profile.html?id=" + data.posts[i].ownerId + "' style='color:white'>" + data.posts[i].userName + "</a></p></div><div class='deletePosts'><div class='col-sm-1' style='display:" + deleteCheck + "'><p style='text-align:right'><a href='#" + id + "-" + data.posts[i].id + "' id='deleePosts' onClick='deletePosts(" + data.posts[i].id + ")'><span class='glyphicon glyphicon-remove' style='font-size:1.2em; color:red'></span></a><p></div></div></div></div><div class='panel-body'><div class='col-sm-9' style='padding-left:0px'><div class='col-sm-12' style='margin-bottom:10px; height:90px'>" + data.posts[i].content + "</div></div><div class='col-sm-3' style='border-left: solid #000000;'><div class='col-sm-12' id='rPost" + data.posts[i].id + "'></div><div class='col-sm-12'><h4 style='text-align:center'>Rating</h4></div><div class='upVotePost'><div class='col-sm-12'><p style='text-align:center'><a href='#" + id + "-" + data.posts[i].id + "' id='upVote' onClick='upVotePosts(" + data.posts[i].id + ")'><span class='glyphicon glyphicon-menu-up' style='font-size:1em'></span></a><p></div></div><div class='col-sm-12' id='ratingPost" + data.posts[i].id + "'><h4 style='text-align:center; margin-top:0px' id='r" + data.posts[i].id + "'>" + (Number(data.posts[i].upVote) + Number(data.posts[i].downVote)) + "</h4></div><div class='downVotePost'><div class='col-sm-12'><p style='text-align:center'><a href='#" + id + "-" + data.posts[i].id + "' id='downVote' onClick='downVotePosts(" + data.posts[i].id + ")'><span class='glyphicon glyphicon-menu-down' style='font-size:1em'></span></a><p></div></div></div><div class='col-sm-12' style='margin-bottom:10px'>" + tagsTab +"</div></div></div></div>";
          $("#Posts").append(html_1);
        };
        tagsTab = '';
        for(var i=0;i<data.tags.length;i++){
          if((i+1) == data.tags.length){
            tagsTab += "<a href='./search.html?query=" + data.tags[i] + "' style='color:black'>" + data.tags[i] + "</a> ";
          }
          else{
            tagsTab += "<a href='./search.html?query=" + data.tags[i] + "' style='color:black'>" + data.tags[i] + "</a>, ";
          }
        }
        $('#tagsName').append(tagsTab);

        var html_2 = '';

        for(var i=0; i<data.toRelated.length; i++){
          html_2 += "<h4><div class='col-sm-12' style='margin-bottom:20px'><div class='col-sm-2'>Topic Name: </div><div class='col-sm-4'>" + data.toRelated[i].topicName + "</div><div class='col-sm-2'>Relation Reason: </div><div class='col-sm-4'>" + data.toRelated[i].label + "</div></div></h4>";
        }
        for(var i=0; i<data.fromRelated.length; i++){
          html_2 += "<h4><div class='col-sm-12' style='margin-bottom:20px'><div class='col-sm-2'>Topic Name: </div><div class='col-sm-4'>" + data.fromRelated[i].topicName + "</div><div class='col-sm-2'>Relation Reason: </div><div class='col-sm-4'>" + data.fromRelated[i].label + "</div></div></h4>";
        }  
        $('#relationsName').append(html_2); 

        if($.cookie('username')) {
          $(".upVotePost").show();
          $(".downVotePost").show();
          $(".deletePosts").show();
        } else {
          $('.upVotePost').hide();
          $('.downVotePost').hide();
          $(".deletePosts").hide();
        }
      } else {
        alert('Ooops! We couldn\'t find that topic :( You\'re being redirected to HomePage');
        window.location.href = "./index.html";
      }
    },
    error: function(){
      alert('Ooops! We couldn\'t find that topic :( You\'re being redirected to HomePage');
      window.location.href = "./index.html";
    }, 
  });
});

//CREATE A RELATION -  TOPIC INPUT VALIDATION
$('#topic1').change(function(){
  var topicName = $('#topic1').val();

  $.ajax({
    url: api + "/api/topic/title/" + topicName,
    success: function(data){
      if (data.result.result === "OK") {
        $('#checkTopic').html('<span class="glyphicon glyphicon-ok" aria-hidden="true" style="color:green;margin-top:10px"></span>');
        $('#topic1').css('border','3px solid green');
        $('#createRelationButton').prop('disabled',false);
        $('#topicId1').val(data.id);
      } else {
        $('#checkTopic').html('<span class="glyphicon glyphicon-remove" aria-hidden="true" style="color:red;margin-top:10px"></span>');
        $('#topic1').css('border','3px solid red');
        $('#createRelationButton').prop('disabled',true);
      }
    },
    error: function(){
      $('#checkTopic').html('<span class="glyphicon glyphicon-remove" aria-hidden="true" style="color:red;margin-top:10px"></span>');
      $('#topic1').css('border','3px solid red');
      $('#createRelationButton').prop('disabled',true);
    }, 
  });
});
//END OF CREATE A RELATION -  TOPIC INPUT VALIDATION

//FUNCTION FOR ADDING A NEW TAG TO AN EXISTING TOPIC
function addNewTag(TagName){
  var newTagName = TagName.length>0 ? TagName : $('#newTag').val();

  $.ajax({
    method: "POST",
    url: api + "/api/topic/add_tag/id/" + id,
      contentType: "application/json",
      dataType: "json",
      data: JSON.stringify({
        tagName: newTagName
      })
    })
      .done(function( data ) {
        if($('#tagsName').html().toString().length>0){
          $('#tagsName').append(', ' + newTagName + ' ');
        }
        else{
          $('#tagsName').append(newTagName + ' ');         
        } 
        $('#addTagMessages').html('<div class="alert alert-success fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Tag is successfully added!</strong> </div>');
        $('#addTagMessages').show('slow');

        setTimeout(function () {
          $('#addTagMessages').hide('slow');
        }, 1500);
        $('#newTag').val('');
      })
      .fail(function( data ) {
        $('#addTagMessages').html('<div class="alert alert-danger fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Something went wrong! Tag could\'nt be added!</strong></div>');
        $('#addTagMessages').show('slow');

        setTimeout(function () {
          $('#addTagMessages').hide('slow');
        }, 1500);
      });
};
//END OF FUNCTION FOR ADDING A NEW TAG TO AN EXISTING TOPIC

//FUNCTION FOR ADDING A NEW RELATION TO AN EXISTING TOPIC
function addNewRelation(rID){
  if($('#relation' + rID).val().length>=3 && $('#topicId' + rID).val()!=0){
    $('#relation' + rID).css('border','1px solid #ccc');
    $('#topic' + rID).css('border','1px solid #ccc');
    var label = $('#relation1').val().toString();
    var toId = Number($('#topicId' + rID).val());
    $.ajax({
      method: "POST",
      url: api + "/api/edge/create_new?user_id=" + $.cookie('id'),
      contentType: "application/json",
      dataType: "json",
      data: JSON.stringify({ 
        from: id,
        to: toId,
        label: label,
        title: label
      })
    })
        .done(function( data ) {
          if (data.id) {
            $('#addRelationMessages').html('<div class="alert alert-success fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Success!</strong> Relation is created</div>');
            $('#addRelationMessages').show('slow');
            
            setTimeout(function () {
              $('#addRelationMessages').hide('slow');
              $('#addRelationPage').modal('hide');
            }, 1500);
            $('#relationsName').append("<h4><div class='col-sm-12' style='margin-bottom:20px'><div class='col-sm-2'>Topic Name: </div><div class='col-sm-4'>" + $('#topic' + rID).val() + "</div><div class='col-sm-2'>Relation: </div><div class='col-sm-4'>" + $('#relation' + rID).val() + "</div></div></h4>");
            $('#relation' + rID).val('');
            $('#topic' + rID).val('');
            $('#checkTopic').html('');
          }
        })
        .fail(function( data ) {
            $('#addRelationMessages').html('<div class="alert alert-danger fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Warning!</strong> Something went wrong!</div>');
            $('#addRelationMessages').show('slow');

            setTimeout(function () {
                $('#addMessages').hide('slow');
            }, 1500);
          });
  }
  else{
    if($('#relation' + rID).val().length<3){
      $('#relation' + rID).css('border','3px solid red');
    }
    else{
      $('#relation' + rID).css('border','1px solid #ccc');
    }
    if($('#topicId' + rID).val()==0){
      $('#topic' + rID).css('border','3px solid red');
    }
    else{
      $('#topic' + rID).css('border','3px solid red');
    }
  }
};
//END OF FUNCTION FOR ADDING A NEW TAG TO AN EXISTING TOPIC

//FUNCTION FOR GETTING THE ID OF THE TOPIC FROM URL
function GetURLParameter(sParam)
{
  var sPageURL = window.location.search.substring(1);
  var sURLVariables = sPageURL.split('&');
  for (var i = 0; i < sURLVariables.length; i++)
  {
    var sParameterName = sURLVariables[i].split('=');
    if(sParameterName[0]==sParam){
      var sP = sParameterName[1].split('%20');
      var title = "";
    }
    for(var i in sP){
      title = title + sP[i] + " ";
    }
  }
  return title;
};
//END OF FUNCTION FOR GETTING THE ID OF THE TOPIC FROM URL

//FUNCTION FOR DELETING THE POST WITH THE ID PARAMETER
function deletePosts(postId)
{
  var conf = confirm('Are you sure?');
  if(conf){
    $.ajax({
      method: "DELETE",
      url: api + "/api/post/delete?id=" + Number(postId),
    })
     .done(function( data ) {
        $('#deleteMessage' + postId).html('<div class="alert alert-success fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Post is succesfully deleted!</strong></div>');
        $('#deleteMessage' + postId).show('slow');

        setTimeout(function () {
          $('#deleteMessage' + postId).hide('slow');
          $('#' + id + '-' + postId).hide('slow');
        }, 1500);
      })
     .fail(function( data ) {
        $('#createPostMessages').html('<div class="alert alert-danger fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Success!</strong>Something went wrong! Post cannot be deleted!</div>');
        $('#createPostMessages').show('slow');

        setTimeout(function () {
          $('#createPostMessages').hide('slow');
          var urlReload = './topic.html?id=' + id;
          window.location.href = urlReload; 
        }, 1500);      
      });
  }
  else{

  }
};
//END OF FUNCTION FOR DELETING THE POST WITH THE ID PARAMETER

//FUNCTION FOR UPVOTING A POST WITH THE POSTID
function upVotePosts(postId){
  var Url = api + "/api/post/id/" + Number(postId) + "/up_vote?user_id=" + Number($.cookie('id'));
  $.ajax({
    method: "POST",
    url: Url,
  })
  .done(function( data ) {
    console.log(data);
    if(data.result.result == "OK"){
      var upVoteCurrent = Number($('#r' + Number(postId)).html());
      $('#r' + Number(postId)).html(upVoteCurrent+1);
    }
    else{
      $('#rPost' + postId).html('<div class="alert alert-danger fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Already upVoted</strong></div>');
      $('#rPost' + postId).show('slow');
    setTimeout(function () {
      $('#rPost' + postId).hide('slow');
    }, 1000);
    }
  })
  .fail(function( data ) {

  });
};
//END OF FUNCTION FOR UPVOTING A POST WITH THE POSTID

//FUNCTION FOR UPVOTING A POST WITH THE POSTID
function downVotePosts(postId){
  var Url = api + "/api/post/id/" + Number(postId) + "/down_vote?user_id=" + Number($.cookie('id')); 
  $.ajax({
    method: "POST",
    url: Url,
  })
  .done(function( data ) {
    console.log(data);
    if(data.result.result = "OK"){
      var downVoteCurrent = Number($('#r' + Number(postId)).html());
      $('#r' + Number(postId)).html(downVoteCurrent-1);
    }
    else{
      $('#rPost' + postId).html('<div class="alert alert-danger fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Already downVoted</strong></div>');
      $('#rPost' + postId).show('slow');
    setTimeout(function () {
      $('#rPost' + postId).hide('slow');
    }, 1000);
    }
  })
  .fail(function( data ) {

  });
};
//END OF FUNCTION FOR UPVOTING A POST WITH THE POSTID

//upVote Click Event
$('#upVote').on('click', function(){
  var Url = api + "/api/topic/id/" + id +"/up_vote?user_id=" + Number($.cookie('id'));
  $.ajax({
    method: "POST",
    url: Url,
  })
  .done(function( data ) {
    console.log(data);
    if(data.result.result=="OK"){
      rating += 1;
      $('#rating').html("<h3 style='text-align:center; margin-top:0px' >" + rating + "</h3>");
    }
    else{
      $('#rMessage').html('<div class="alert alert-danger fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Already upVoted</strong></div>');
      $('#rMessage').show('slow');
    setTimeout(function () {
      $('#rMessage').hide('slow');
    }, 1000);
    }
  })
  .fail(function( data ) {

  });
});
//End of upVote Click Event

//downVote Click Event
$('#downVote').on('click', function(){
  var Url = api + "/api/topic/id/" + id +"/down_vote?user_id=" + Number($.cookie('id'));
  $.ajax({
    method: "POST",
    url: Url,
  })
  .done(function( data ) {
    console.log(data);
    if(data.result.result=="OK"){
      rating -= 1;
      $('#rating').html("<h3 style='text-align:center; margin-top:0px' >" + rating + "</h3>");
    }
    else{
      $('#rMessage').html('<div class="alert alert-danger fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Already downVoted</strong></div>');
      $('#rMessage').show('slow');
    setTimeout(function () {
      $('#rMessage').hide('slow');
    }, 1000);
  }
})
  .fail(function( data ) {

  });
});
//End of downVote Click Event

$('#sendPostButton').on('click', function () {
  var tags = [];
  if($('#postText').val().length>2){
    if($('#tag1').val().length>2){
      tags.push($('#tag1').val());
    }
    if($('#tag2').val().length>2){
      tags.push($('#tag2').val());
    }
    if($('#tag3').val().length>2){
      tags.push($('#tag3').val());
    }
    if($('#tag4').val().length>2){
      tags.push($('#tag4').val());
    }
    $.ajax({
      method: "POST",
      url: api + "/api/post/create?topicId=" + id,
      contentType: "application/json",
      dataType: "json",
      data: JSON.stringify({
        content: $('#postText').val(),
        ownerId: Number($.cookie('id')),
        tagsOfPost: tags
      })
    })
      .done(function( data ) {
        $('#createPostMessages').html('<div class="alert alert-success fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Post is successfully created!</strong> </div>');
        $('#createPostMessages').show('slow');

        setTimeout(function () {
          $('#createPostMessages').hide('slow');
          var urlReload = './topic.html?id=' + id;
          window.location.href = urlReload; 
        }, 1500);
      })
      .fail(function( data ) {
        $('#createPostMessages').html('<div class="alert alert-danger fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Warning!</strong> Something went wrong!</div>');
        $('#createPostMessages').show('slow');
        setTimeout(function () {
          $('#createPostMessages').hide('slow');
        }, 1500);
      });
  }
  else{
    $('#postText').css('border','3px solid red');
    $('#createPostMessages').html('<div class="alert alert-danger fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Warning!</strong> Please enter a longer post!</div>');
    $('#createPostMessages').show('slow');
    setTimeout(function () {
      $('#createPostMessages').hide('slow');
    }, 1000);
  }
});

$('#loginform').validator().on('submit', function (e) {
  if (e.isDefaultPrevented()) {
    // handle the invalid form...
  } else {
    e.preventDefault();
    // everything looks good!

      $.ajax({
        method: "GET",
        url: api + "/api/user/login",
        dataType: "json",
        data: { 
          username: $('#username').val(),
          password: $('#password').val(),
        },
      })
      .done(function( data ) {
          
          if (data.result.result === "OK") {
            $.cookie('username', data.username, { expires: 1 });
            $.cookie('id', data.id, { expires: 1 });
            var currentusr = $.cookie('username');

            $('#loginform').hide();
            $('#profile').html(data.username);
            $('#logindetails').show('slow');

            $('#loginMessages').html('<div class="alert alert-success fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Success!</strong> ' + data.result.resultMessage + '</div>');
            $('#loginMessages').show('slow');

            setTimeout(function () {
              $('#loginMessages').hide('slow');
                window.location.reload();
            }, 1000);
          } else {
            $('#loginMessages').html('<div class="alert alert-danger fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Warning!</strong> ' + data.result.resultMessage + '</div>');
            $('#loginMessages').show('slow');

            setTimeout(function () {
                $('#loginMessages').hide('slow');
            }, 1000);
          }  
        })
        .fail(function( data ) {
            $('#loginMessages').html('<div class="alert alert-danger fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Warning!</strong> Something went wrong!</div>');
            $('#loginMessages').show('slow');
            setTimeout(function () {
              $('#loginMessages').hide('slow');
            }, 1000);
            btn.button('reset');
          });
  }
});

$('#registerform').validator().on('submit', function (e) {
  if (e.isDefaultPrevented()) {
    // handle the invalid form...
  } else {
    e.preventDefault();
    // everything looks good!
      $.ajax({
        method: "POST",
        url: api + "/api/user/signup",
        contentType: "application/json",
        dataType: "json",
        data: JSON.stringify({ 
          username: $('#registerUsername').val(),
          email:    $('#registerEmail').val(),
          password: $('#registerPassword').val()
        })
      })
        .done(function( data ) {
          
          if (data.result.result === "OK") {

            $('#registerMessages').html('<div class="alert alert-success fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Success!</strong> ' + data.result.resultMessage + '</div>');
            $('#registerMessages').show('slow');
            
            setTimeout(function () {
              $('#registerMessages').hide('slow');
              $('#registerPage').modal('hide');
            }, 2000);
          } else {

            $('#registerMessages').html('<div class="alert alert-danger fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Warning!</strong> ' + data.result.resultMessage + '</div>');
            $('#registerMessages').show('slow');

            setTimeout(function () {
                $('#registerMessages').hide('slow');
            }, 3000);

          }  
            btn.button('reset');
        })
        .fail(function( data ) {
            $('#registerMessages').html('<div class="alert alert-danger fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Warning!</strong> Something went wrong!</div>');
            $('#registerMessages').show('slow');

            setTimeout(function () {
                $('#registerMessages').hide('slow');
            }, 3000);

              btn.button('reset');
          });
  }
});

$('#logoutbtn').on('click', function(e){
  e.preventDefault();
  if($.removeCookie('username')) {

    $('#loginMessages').html('<div class="alert alert-success fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Success!</strong> Successfully logged out! Refreshing the page now...</div>');
    $('#loginMessages').show('slow');

    setTimeout(function () {
      $('#loginMessages').hide('slow');
      window.location.reload();
    }, 1500);
  }
});
</script>
</body>
</html>